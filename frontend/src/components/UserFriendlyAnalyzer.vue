<template>
  <div class="user-friendly-analyzer">
    <!-- ä¸»æ ‡é¢˜ -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">åŸºé‡‘æ™ºèƒ½åŠ©æ‰‹</h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        å¸®æ‚¨è½»æ¾é€‰æ‹©ä¼˜è´¨åŸºé‡‘ï¼Œæ™ºèƒ½é…ç½®æŠ•èµ„ç»„åˆ
      </p>
    </div>
    
    <!-- ä½¿ç”¨æ­¥éª¤å¼•å¯¼ -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-semibold text-gray-800 mb-2">ä¸‰æ­¥å®Œæˆæ™ºèƒ½åˆ†æ</h2>
        <p class="text-gray-600">ç®€å•æ˜“ç”¨ï¼Œæ— éœ€ä¸“ä¸šçŸ¥è¯†</p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl font-bold text-blue-600">1</span>
          </div>
          <h3 class="font-medium text-gray-800 mb-2">é€‰æ‹©åŸºé‡‘</h3>
          <p class="text-gray-600 text-sm">ä»çƒ­é—¨åŸºé‡‘ä¸­é€‰æ‹©ï¼Œæˆ–æœç´¢æ‚¨æ„Ÿå…´è¶£çš„åŸºé‡‘</p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl font-bold text-green-600">2</span>
          </div>
          <h3 class="font-medium text-gray-800 mb-2">é€‰æ‹©é£æ ¼</h3>
          <p class="text-gray-600 text-sm">æ ¹æ®æ‚¨çš„é£é™©åå¥½é€‰æ‹©æŠ•èµ„é£æ ¼</p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl font-bold text-purple-600">3</span>
          </div>
          <h3 class="font-medium text-gray-800 mb-2">æŸ¥çœ‹ç»“æœ</h3>
          <p class="text-gray-600 text-sm">è·å–ä¸ªæ€§åŒ–æŠ•èµ„å»ºè®®å’Œé£é™©æç¤º</p>
        </div>
      </div>
    </div>
    
    <!-- çƒ­é—¨åŸºé‡‘æ¨è -->
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 mb-8">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">ğŸ”¥ çƒ­é—¨åŸºé‡‘æ¨è</h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        <div 
          v-for="(fund, index) in hotFunds" 
          :key="index"
          @click="selectHotFund(fund)"
          class="bg-white rounded-xl p-4 shadow hover:shadow-md transition-shadow cursor-pointer transform hover:scale-105"
        >
          <div class="flex items-center justify-between mb-2">
            <div>
              <div class="font-bold text-gray-900 text-lg">{{ fund.code }}</div>
              <div class="text-gray-600 text-sm mt-1">{{ fund.name }}</div>
            </div>
            <div class="text-yellow-500">
              <svg v-for="i in 5" :key="i" class="h-5 w-5 inline" :class="i <= fund.rating ? 'text-yellow-400' : 'text-gray-300'" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            </div>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">{{ fund.type }}</span>
            <span class="text-green-600 font-medium">è¯„çº§{{ fund.rating }}æ˜Ÿ</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- è‡ªå®šä¹‰é€‰æ‹©åŒºåŸŸ -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">ğŸ” è‡ªå®šä¹‰é€‰æ‹©</h2>
      
      <!-- æœç´¢æ¡† -->
      <div class="mb-6">
        <label class="block text-lg font-medium text-gray-800 mb-3">æœç´¢åŸºé‡‘</label>
        <div class="flex space-x-4">
          <input 
            v-model="searchKeyword"
            @keyup.enter="searchFunds"
            type="text" 
            class="flex-1 rounded-xl border-2 border-gray-200 px-4 py-3 text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
            placeholder="è¾“å…¥åŸºé‡‘ä»£ç æˆ–åç§°ï¼Œä¾‹å¦‚ï¼šæ˜“æ–¹è¾¾æ¶ˆè´¹è¡Œä¸š"
          />
          <button 
            @click="searchFunds"
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-medium text-lg transition-colors"
          >
            æœç´¢
          </button>
        </div>
      </div>
      
      <!-- æœç´¢ç»“æœ -->
      <div v-if="searchResults.length > 0" class="mb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-3">æœç´¢ç»“æœ</h3>
        <div class="max-h-60 overflow-y-auto border rounded-lg">
          <div 
            v-for="fund in searchResults" 
            :key="fund.code"
            @click="addFund(fund)"
            class="flex items-center p-4 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"
          >
            <div class="mr-4">
              <svg v-for="i in 5" :key="i" class="h-5 w-5 inline" :class="i <= fund.rating ? 'text-yellow-400' : 'text-gray-300'" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            </div>
            <div class="flex-1">
              <div class="font-bold text-gray-900">{{ fund.code }}</div>
              <div class="text-gray-600">{{ fund.name }}</div>
              <div class="text-sm text-gray-500">{{ fund.type }}</div>
            </div>
            <div class="text-green-600 font-medium">è¯„çº§{{ fund.rating }}æ˜Ÿ</div>
          </div>
        </div>
      </div>
      
      <!-- å·²é€‰æ‹©åŸºé‡‘ -->
      <div v-if="selectedFunds.length > 0" class="mb-6">
        <h3 class="text-lg font-medium text-gray-800 mb-3">å·²é€‰æ‹©çš„åŸºé‡‘ ({{ selectedFunds.length }})</h3>
        <div class="flex flex-wrap gap-3">
          <div 
            v-for="fund in selectedFunds" 
            :key="fund.code"
            class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full flex items-center"
          >
            <span class="font-medium">{{ fund.code }}</span>
            <span class="ml-2 text-sm">{{ fund.name }}</span>
            <button 
              @click="removeFund(fund)" 
              class="ml-3 text-blue-600 hover:text-blue-800 font-bold"
            >
              Ã—
            </button>
          </div>
        </div>
      </div>
      
      <!-- æŠ•èµ„é£æ ¼é€‰æ‹© -->
      <div class="mb-8">
        <label class="block text-lg font-medium text-gray-800 mb-3">é€‰æ‹©æ‚¨çš„æŠ•èµ„é£æ ¼</label>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <button 
            v-for="style in investmentStyles" 
            :key="style.value"
            @click="selectedStyle = style.value"
            :class="[
              selectedStyle === style.value 
                ? 'bg-green-600 text-white border-green-600' 
                : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50',
              'border-2 rounded-xl p-6 text-center transition-all'
            ]"
          >
            <div class="text-2xl mb-2">{{ style.icon }}</div>
            <div class="font-bold text-lg mb-1">{{ style.name }}</div>
            <div class="text-sm">{{ style.description }}</div>
          </button>
        </div>
      </div>
      
      <!-- å¼€å§‹åˆ†ææŒ‰é’® -->
      <div class="text-center">
        <button 
          @click="startAnalysis"
          :disabled="selectedFunds.length === 0 || analyzing"
          class="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white font-bold py-4 px-12 rounded-xl text-xl transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
        >
          {{ analyzing ? 'åˆ†æä¸­...' : 'ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æ' }}
        </button>
        <p class="text-gray-500 text-sm mt-3">åˆ†æå®Œæˆåï¼Œæ‚¨å°†è·å¾—ä¸ªæ€§åŒ–çš„æŠ•èµ„å»ºè®®</p>
      </div>
    </div>
    
    <!-- åˆ†æç»“æœåŒºåŸŸ -->
    <div v-if="analysisResult" class="bg-white rounded-2xl shadow-lg p-8">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“Š æ‚¨çš„æŠ•èµ„åˆ†ææŠ¥å‘Š</h2>
        <p class="text-gray-600">åŸºäº{{ selectedFunds.length }}åªåŸºé‡‘çš„æ™ºèƒ½åˆ†æ</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- é¢„æœŸæ”¶ç›Š -->
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6">
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">é¢„æœŸæ”¶ç›Š</h3>
              <p class="text-gray-600 text-sm">åŸºäºå†å²æ•°æ®ä¼°ç®—</p>
            </div>
          </div>
          <div class="text-3xl font-bold text-green-600 mb-2">{{ expectedReturn }}%</div>
          <p class="text-gray-600 text-sm">å¹´åŒ–é¢„æœŸæ”¶ç›Šç‡</p>
        </div>
        
        <!-- é£é™©ç­‰çº§ -->
        <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-6">
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">é£é™©ç­‰çº§</h3>
              <p class="text-gray-600 text-sm">å¯èƒ½é¢ä¸´çš„æœ€å¤§äºæŸ</p>
            </div>
          </div>
          <div class="text-3xl font-bold text-red-600 mb-2">{{ maxDrawdown }}%</div>
          <p class="text-gray-600 text-sm">åœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½çš„æœ€å¤§äºæŸ</p>
        </div>
      </div>
      
      <!-- ç»„åˆé…ç½® -->
      <div class="mt-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">æ‚¨çš„æ™ºèƒ½é…ç½®æ–¹æ¡ˆ</h3>
        <div class="space-y-4">
          <div v-for="(weight, fundCode) in analysisResult.portfolio" :key="fundCode" class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                <span class="font-bold text-blue-600">{{ fundCode.slice(-2) }}</span>
              </div>
              <div>
                <div class="font-medium text-gray-800">{{ getFundName(fundCode) }}</div>
                <div class="text-sm text-gray-600">{{ fundCode }}</div>
              </div>
            </div>
            <div class="text-right">
              <div class="font-bold text-lg text-gray-800">{{ (weight * 100).toFixed(1) }}%</div>
              <div class="w-32 bg-gray-200 rounded-full h-2 mt-1">
                <div 
                  class="bg-blue-600 h-2 rounded-full" 
                  :style="{ width: (weight * 100) + '%' }"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- é£é™©æç¤º -->
      <div class="mt-8 p-6 bg-red-50 border border-red-200 rounded-xl">
        <div class="flex items-center mb-3">
          <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
          <h3 class="text-lg font-semibold text-red-800">é‡è¦é£é™©æç¤º</h3>
        </div>
        <div class="text-red-700 space-y-2">
          <p>â€¢ åŸºé‡‘æŠ•èµ„æœ‰é£é™©ï¼Œè¿‡å¾€ä¸šç»©ä¸ä»£è¡¨æœªæ¥è¡¨ç°</p>
          <p>â€¢ æ ¹æ®æ‚¨çš„æŠ•èµ„é£æ ¼ï¼Œè¯¥ç»„åˆå±äº<strong>{{ investmentStyleText }}</strong>ç±»å‹</p>
          <p>â€¢ åœ¨å¸‚åœºæç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°{{ maxDrawdown }}%çš„äºæŸ</p>
          <p class="italic mt-3">æœ¬åˆ†æåŸºäºå†å²æ•°æ®ï¼Œä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„å‰è¯·ä»”ç»†é˜…è¯»åŸºé‡‘åˆåŒå’Œæ‹›å‹Ÿè¯´æ˜ä¹¦ã€‚</p>
        </div>
      </div>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <div class="mt-8 text-center">
        <button 
          @click="resetAnalysis"
          class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-8 rounded-xl transition-colors"
        >
          é‡æ–°åˆ†æ
        </button>
      </div>
    </div>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  name: 'UserFriendlyAnalyzer',
  data() {
    return {
      // çƒ­é—¨åŸºé‡‘ï¼ˆç²¾é€‰20åªï¼‰
      hotFunds: [
        { code: '000002', name: 'æ˜“æ–¹è¾¾æ¶ˆè´¹è¡Œä¸šè‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 5 },
        { code: '000004', name: 'å¯Œå›½å¤©æƒ æˆé•¿æ··åˆ', type: 'æ··åˆå‹', rating: 5 },
        { code: '000007', name: 'æ™¯é¡ºé•¿åŸæ–°å…´æˆé•¿æ··åˆ', type: 'æ··åˆå‹', rating: 5 },
        { code: '005669', name: 'å‰æµ·å¼€æºå…¬ç”¨äº‹ä¸šè‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 5 },
        { code: '005827', name: 'æ˜“æ–¹è¾¾è“ç­¹ç²¾é€‰æ··åˆ', type: 'æ··åˆå‹', rating: 5 },
        { code: '006751', name: 'å¯Œå›½äº’è”ç§‘æŠ€è‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 5 },
        { code: '161005', name: 'å¯Œå›½å¤©æƒ LOF', type: 'æ··åˆå‹', rating: 5 },
        { code: '110022', name: 'æ˜“æ–¹è¾¾æ¶ˆè´¹è¡Œä¸šè‚¡ç¥¨A', type: 'è‚¡ç¥¨å‹', rating: 5 },
        { code: '260108', name: 'æ™¯é¡ºé•¿åŸæ–°å…´æˆé•¿æ··åˆ', type: 'æ··åˆå‹', rating: 5 },
        { code: '001744', name: 'è¯ºå®‰æˆé•¿æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '001616', name: 'å˜‰å®ç¯ä¿ä½ç¢³è‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 4 },
        { code: '000001', name: 'åå¤æˆé•¿æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '000003', name: 'å˜‰å®æ–°å…´äº§ä¸šè‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 4 },
        { code: '000005', name: 'å…´å…¨åˆæ¶¦æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '000006', name: 'ä¸­æ¬§åŒ»ç–—å¥åº·æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '000008', name: 'æ±‡æ·»å¯Œä»·å€¼ç²¾é€‰æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '000009', name: 'å·¥é“¶ç‘ä¿¡å‰æ²¿åŒ»ç–—è‚¡ç¥¨', type: 'è‚¡ç¥¨å‹', rating: 4 },
        { code: '000010', name: 'å¹¿å‘ç¨³å¥å¢é•¿æ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '001632', name: 'æ³“å¾·æ³“å¯Œæ··åˆ', type: 'æ··åˆå‹', rating: 4 },
        { code: '003096', name: 'ä¸­æ¬§åŒ»ç–—å¥åº·æ··åˆC', type: 'æ··åˆå‹', rating: 4 }
      ],
      
      // æŠ•èµ„é£æ ¼é€‰é¡¹
      investmentStyles: [
        {
          value: 'conservative',
          name: 'ä¿å®ˆå‹',
          icon: 'ğŸ›¡ï¸',
          description: 'æ³¨é‡æœ¬é‡‘å®‰å…¨ï¼Œæ¥å—è¾ƒä½æ”¶ç›Š',
          riskLevel: 0.3
        },
        {
          value: 'balanced',
          name: 'ç¨³å¥å‹', 
          icon: 'âš–ï¸',
          description: 'å¹³è¡¡æ”¶ç›Šä¸é£é™©ï¼Œé€‚åˆå¤§å¤šæ•°æŠ•èµ„è€…',
          riskLevel: 0.5
        },
        {
          value: 'aggressive',
          name: 'æ¿€è¿›å‹',
          icon: 'ğŸš€',
          description: 'è¿½æ±‚é«˜æ”¶ç›Šï¼Œèƒ½æ‰¿å—è¾ƒå¤§æ³¢åŠ¨',
          riskLevel: 0.7
        }
      ],
      
      // ç”¨æˆ·è¾“å…¥
      searchKeyword: '',
      searchResults: [],
      selectedFunds: [],
      selectedStyle: 'balanced',
      
      // åˆ†æçŠ¶æ€
      analyzing: false,
      analysisResult: null
    };
  },
  computed: {
    expectedReturn() {
      if (!this.analysisResult) return '0';
      const annualReturn = this.analysisResult.portfolioMetrics.annual_return;
      return (annualReturn * 100).toFixed(1);
    },
    maxDrawdown() {
      if (!this.analysisResult) return '0';
      const drawdown = this.analysisResult.portfolioMetrics.max_drawdown;
      return (Math.abs(drawdown) * 100).toFixed(1);
    },
    investmentStyleText() {
      const styleMap = {
        'conservative': 'ä¿å®ˆå‹',
        'balanced': 'ç¨³å¥å‹', 
        'aggressive': 'æ¿€è¿›å‹'
      };
      return styleMap[this.selectedStyle] || 'ç¨³å¥å‹';
    }
  },
  methods: {
    async searchFunds() {
      if (!this.searchKeyword.trim()) {
        this.searchResults = [];
        return;
      }
      
      try {
        const params = { keyword: this.searchKeyword, limit: 10 };
        const response = await axios.get('/api/funds/search', { params });
        
        if (response.data.status === 'success') {
          this.searchResults = response.data.funds;
        }
      } catch (error) {
        console.error('æœç´¢åŸºé‡‘å¤±è´¥:', error);
        alert('æœç´¢åŸºé‡‘å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    },
    
    addFund(fund) {
      if (!this.selectedFunds.find(f => f.code === fund.code)) {
        this.selectedFunds.push(fund);
        this.searchResults = [];
        this.searchKeyword = '';
      }
    },
    
    removeFund(fundToRemove) {
      this.selectedFunds = this.selectedFunds.filter(fund => fund.code !== fundToRemove.code);
    },
    
    selectHotFund(fund) {
      if (!this.selectedFunds.find(f => f.code === fund.code)) {
        this.selectedFunds.push(fund);
      }
    },
    
    getFundName(fundCode) {
      const selectedFund = this.selectedFunds.find(f => f.code === fundCode);
      if (selectedFund) {
        return selectedFund.name;
      }
      
      const hotFund = this.hotFunds.find(f => f.code === fundCode);
      if (hotFund) {
        return hotFund.name;
      }
      
      return `åŸºé‡‘${fundCode}`;
    },
    
    async startAnalysis() {
      if (this.selectedFunds.length === 0) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€åªåŸºé‡‘');
        return;
      }
      
      try {
        this.analyzing = true;
        
        // æ„å»ºåŸºé‡‘æ± æ•°æ®
        const fundPool = {};
        for (const fund of this.selectedFunds) {
          try {
            const response = await axios.get(`/api/funds/${fund.code}`);
            if (response.data.status === 'success') {
              const returns = response.data.nav_history.map(item => item.daily_return);
              fundPool[fund.code] = { returns };
            }
          } catch (error) {
            console.warn(`è·å–åŸºé‡‘ ${fund.code} æ•°æ®å¤±è´¥:`, error);
          }
        }
        
        if (Object.keys(fundPool).length === 0) {
          throw new Error('æ— æ³•è·å–ä»»ä½•åŸºé‡‘çš„å†å²æ•°æ®');
        }
        
        // è·å–é£é™©åå¥½
        const selectedStyleObj = this.investmentStyles.find(s => s.value === this.selectedStyle);
        const riskTolerance = selectedStyleObj ? selectedStyleObj.riskLevel : 0.5;
        
        // æ‰§è¡Œå®Œæ•´åˆ†ææµç¨‹
        const response = await axios.post('/api/analyze', {
          fund_pool: fundPool
        });
        
        if (response.data.status === 'success') {
          this.analysisResult = {
            portfolio: response.data.portfolio,
            portfolioMetrics: response.data.risk_report.risk_metrics,
            riskAssessment: response.data.risk_report.risk_assessment
          };
        } else {
          throw new Error(response.data.error);
        }
        
      } catch (error) {
        console.error('åˆ†æå¤±è´¥:', error);
        alert('åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      } finally {
        this.analyzing = false;
      }
    },
    
    resetAnalysis() {
      this.analysisResult = null;
      this.selectedFunds = [];
      this.selectedStyle = 'balanced';
    }
  }
};
</script>